## **产品需求文档 (PRD): The Wizard V1**

* **文档版本:** 2.0 (Final Draft)
* **文档状态:** **待审批 (For Review)**
* **产品负责人:** Gemini (Senior Product Manager)
* **核心团队:** 携程内部开发团队
* **最后更新:** 2025年9月21日

### **1. 愿景与简介 (Vision & Introduction)**

"The Wizard" 是一款深度集成于Cursor IDE的智能协作伙伴，专为那些在大型、复杂代码库中工作的专业开发者设计。它旨在解决开发者在应用AI编程时面临的核心挑战——信任缺失与心力损耗。通过一套**引导式、可验证的“规格先行”工作流**，"The Wizard" 将AI从一个难以捉摸的“黑盒”，转变为一个值得信赖的、始终在开发者掌控之下的自动化专家，让开发者能将宝贵的精力聚焦于最高价值的创造性工作中。

### **2. 产品原则 (Tenets)**

在任何功能设计或技术权衡中，我们都将遵循以下三大原则：

* **原则一：开发者永远是最终控制者 (Developer in Control)。** 我们的任何自动化功能都必须是透明的、可审查的，并且在关键步骤需要得到开发者的明确批准。我们赋予能力，而非剥夺控制。
* **原则二：透明度建立信任 (Transparency Builds Trust)。** 我们优先将AI的“思考过程”可视化，而不是追求最快的“一键生成”。开发者看到得越清晰，就越敢于信任。
* **原则三：最小化上下文切换 (Minimize Context Switching)。** 产品的设计应尽可能让开发者停留在IDE的核心工作流中。任何UI的出现都应是短暂、专注且必要的。

### **3. 客户与核心问题 (The Customer & The Problem)**

**3.1 用户画像 (User Persona)**

我们的核心用户是“**资深但持怀疑态度的开发者 (The Senior but Skeptic Developer)**”。
* **特点:** 他们拥有丰富的领域知识，对代码质量有极高的要求。他们认可AI在编写模板代码或简单脚本上的潜力，但对于让AI直接触碰核心业务逻辑持强烈的怀疑态度。
* **核心担忧:** “AI写的代码能保证质量吗？它理解我们复杂的业务规则吗？修复AI造成的‘幻觉’问题，会不会比我自己写还要耗时？”

**3.2 核心问题 (The Core Problem)**

当前，在复杂业务开发中应用AI编程工具，开发者面临一个两难困境：要么选择“**盲目信任**”，将复杂任务交给AI，然后花费大量时间去验证和调试其“黑盒”产出；要么选择“**完全不信**”，退回到传统的手工编码模式，错失了提升生产力的机会。这两种选择都伴随着巨大的**心力损耗**和**机会成本**。

### **4. V1 解决方案 (The V1 Solution)**

V1版本的 "The Wizard" 将聚焦于解决这一核心困境，提供一个全新的协作模式。

**4.1 核心价值主张**

我们提供一个引导式的、名为`规格先行开发 (Spec-Then-Code)`的工作流，它将复杂功能的开发过程，拆解为一系列清晰、可控、且经过开发者审批的步骤。

**4.2 The RIPER-5 交互框架**

整个工作流由 `RIPER-5` 框架驱动，确保每一次交互都有明确的目标：
* **Read:** AI理解上下文。
* **Insight:** AI与开发者对齐任务模式。
* **Plan:** AI提交可视化计划，待开发者审批。
* **Execute:** AI严格按计划，先产出测试，再产出代码。
* **Refine:** AI自证其产出与计划一致，待开发者最终确认。

### **5. 详细功能需求 (Functional Requirements)**

#### **5.1 入口: 智能任务分流 (Insight Stage)**
* **FR-1.1:** 当用户通过 `@TheWizard` 发起任务时，系统必须响应并提供四种协作模式选项，分别对应AI编程的四象限（快速脚本、探索性原型、TDD、规格先行）。
* **FR-1.2:** V1的核心流程将聚焦于用户选择`[规格先行开发]`的场景。

#### **5.2 规划阶段: 可视化与可编辑的蓝图 (Plan Stage)**
* **FR-2.1:** 系统必须在一个专用的弹窗UI中，生成至少两种视图的DAAS蓝图（**时序图**和**类图**），以供用户交叉验证。
* **FR-2.2:** UI必须提供一个双栏编辑器，允许具备相应能力的开发者直接修改图表的源码（如Mermaid），并实时预览结果。
* **FR-2.3:** UI必须提供一个对话式输入框，允许用户通过自然语言提出对蓝图的修改意见。
* **FR-2.4:** 流程必须在用户明确点击 **[Confirm Blueprint]** 后才能继续。

#### **5.3 执行阶段: 测试先行与代码生成 (Execute Stage)**
* **FR-3.1:** 在用户批准蓝图后，系统**必须**先在一个可编辑的表格中，生成关键的单元测试用例，并等待用户点击 **[Approve Tests & Generate Code]** 进行审批。
* **FR-3.2:** 在用户批准测试后，系统**必须**严格依据已批准的蓝图和测试用例，在Cursor聊天框中生成实现代码。

#### **5.4 验证阶段: 代码溯源 (Refine Stage)**
* **FR-4.1:** 在生成代码后，系统**必须**自动对生成的代码进行分析，并逆向生成一份新的DAAS图。
* **FR-4.2:** 系统必须在一个UI中，并排展示**“规划蓝图”**与**“代码溯源蓝图”**，供用户进行最终比对和验证。
* **FR-4.3:** 只有当用户点击 **[Accept Code]** 后，整个工作流才算成功完成。

### **6. V1 范围定义 (V1 Scope Definition)**

#### **6.1 V1 范围内 (In Scope for V1)**

* 一个完整的、端到端的`规格先行开发`工作流，包含上述所有功能需求。
* 支持在流程中返回上一步进行修改，并提供会话内的版本控制。
* 一个基于配置文件（JSON/YAML）的、可插拔的引导框架引擎。
* 对AI明确表示“无法完成”的响应进行优雅降级处理。
* 实现用于计算**核心流程完成率**的基础事件日志记录。

#### **6.2 V1 范围外 (Explicitly Out of Scope for V1)**

* **全面的性能优化:** V1依赖底层平台的基线性能。
* **自定义的可靠性与安全加固:** V1依赖底层平台和基础设施。
* **"引导框架市场 (Guide-Store)" 的开发:** 这是V1之后的长远规划。
* **完整的指标仪表盘:** V1只关注核心指标的后台日志记录。
* **除“规格先行”外的其他三种协作模式的深度功能实现。**

### **7. 成功衡量指标 (Success Metrics)**

V1的成功只有一个衡量标准，我们的**北极星指标**是：

* **核心流程完成率 (Happy Path Completion Rate):** 在所有启动`规格先行开发`的会话中，最终成功点击`[Accept Code]`的比例。**我们的目标是证明这个流程是可行且值得信赖的。**